

> This document specifies the **requirements for the first MVP** (what to build and how it behaves).
> For the long-term vision and adaptive loop, see `sisy/docs/vision.md`.

## 0. MVP goal, scope, and non-goals

- **MVP goal:** Keep the user oriented on a viable **next step** with minimal interaction, even when the day changes.
- **MVP scope (must ship):**
  - Omni-Chat input available from every screen
  - Minimalist Home “now/next” view
  - Routine template storage/editing (basic)
  - Lightweight profile (“Me”) view for what the system knows
  - Simple reschedule + completion signals
- **Non-goals (MVP):**
  - Full calendar replacement / complex scheduling engine
  - Social / collaboration
  - Deep health analytics (medical-grade)

## 1. Brand identity & UX principles (MVP constraints)

- **Design language:** **Extreme Minimalism**
- **Interaction mood:** Like an old friend—present when needed, invisible when you are focused.
- **MVP UX constraints:**
  - **One-primary-action** per screen (everything else is secondary or hidden)
  - **No setup wall:** user can start with empty profile + empty routine
  - **Speed:** most interactions should be doable in <10 seconds

## 2. Information architecture

- **Bottom navigation:** Home / Routine / Me
- **Omni-Chat:** persistent input anchored above the nav, available everywhere

## 3. Functional modules (MVP requirements)

### The "Omni-Chat" Layer

SiSy is an always-available companion.

- **Persistent input (REQ-CHAT-1):** A chat input field is anchored above the navigation bar on **every screen** (Home, Routine, Me).
    
- **Context awareness (REQ-CHAT-2):** The input knows which tab is active and includes that context in the message payload.
        
- **Smart Drawer (REQ-CHAT-3):** Tapping the input expands a drawer over current content showing recent chat history, without navigating away.
- **Message types (REQ-CHAT-4):** Support at least:
  - **State update:** “I’m exhausted”, “I have 20 minutes”
  - **Intent:** “Help me plan today”, “Move my next task”
  - **Capture:** “Remind me to …”, “I need to …”

**Acceptance criteria**
- **AC-CHAT-1:** Input is visible on Home/Routine/Me and remains usable after switching tabs.
- **AC-CHAT-2:** Opening/closing the drawer does not reset the underlying screen state.

### The Navigation Anchor

A minimalist bottom navigation bar allows instant switching between the three core dimensions of the user's life.

- **Layout (REQ-NAV-1):** Three icon-based buttons located at the very bottom of the screen.
    
    1. **Home:** The minimalist page about the current or next Task.
        
    2. **Routine:** The page about the default routine template.
        
    3. **Me:** The page about the user profile, SiSy's learning about the user
        
- **Behavior (REQ-NAV-2):** Single tap to switch. Double-tap on the active tab to scroll to the top (or refresh context).

**Acceptance criteria**
- **AC-NAV-1:** Switching tabs is instant and does not lose the current “now/next” task state.
- **AC-NAV-2:** Double-tap on active tab scrolls to top (or triggers refresh) consistently.

### 3.1 Home: Minimalist Command Center

- **Primary view (REQ-HOME-1):** Full screen with a single focal area that shows:
  - a **start time label** (e.g. `11:00 AM`)
  - the **current/next task title**
- **Empty state (REQ-HOME-2):** Show something relaxing and encouraging.

- **Core Actions:**
    
    - **Time tweak (REQ-HOME-3):** Tap + slide to postpone/pull a task time.
      - After adjustment, SiSy confirms the new time.
      - Optionally asks for a reason (“Want to tell me why?”) depending on user preference.
        
    - **Completion feedback (REQ-HOME-4):** Mark task as done with one gesture/tap.
      - SiSy may ask a lightweight follow-up (“How do you feel?”) depending on user preference and task type.
    - **Gesture mapping (REQ-HOME-5):** The MVP must define and implement a consistent, discoverable gesture set:
      - **Swipe right:** complete current task
      - **Swipe left:** open reschedule (time tweak) interaction
      - **Tap:** open details (optional) or focus Omni-Chat (fallback)

**Acceptance criteria**
- **AC-HOME-1:** Home never shows more than one primary “card” / focal area of content (excluding the persistent chat input).
- **AC-HOME-2:** Rescheduling and completion require no more than one confirmation step.
- **AC-HOME-3:** Gestures are consistent across sessions and have a lightweight hint the first time (or via a help affordance).
        

### 3.2 "Me" Interface

- **Function (REQ-ME-1):** Visualize the user profile as simple key-value sections (e.g., Basics / Nutrition / Fitness / Rest).
- **Layout (REQ-ME-2):** Render fields as **two-column rows** (key on the left, value on the right) 
- **Long values (REQ-ME-3):** Values may be long strings and arbitrary text; the default overview should **truncate (ellipsis)** to keep rows compact.
  - When editing/viewing details, the full value should be accessible, inline edit mode for shot value or a dedicated detail view for long value).

- **Purpose:** Let users see how SiSy understands them.

**Acceptance criteria**
- **AC-ME-1:** User can view all stored fields without layout breaking.
- **AC-ME-2:** User can edit or delete a field (even if “AI learned”) in MVP.
    

### 3.3 "Routine" Interface

- **Function (REQ-ROUTINE-1):** Store the user’s Routine Template (the default day structure).
    
- **Linkage (REQ-ROUTINE-2):** Routine is the “master template” referenced when generating today’s tasks.
- **Editing (REQ-ROUTINE-3):** User can add/edit/remove routine items (at minimum: title + optional time window).
- **Minimum editor UI (REQ-ROUTINE-4):** The Routine screen must support, at minimum:
  - A list of routine items
  - “Add” action
  - Inline edit of title and optional time window
  - Delete action (with one-step confirmation)
  - An **Auto-complete toggle** per item (see REQ-ROUTINE-5)

- **Auto-complete semantics (REQ-ROUTINE-5):**
  - User can **opt an item into auto-completion** (e.g. “Wake up”).
  - When an item is marked auto-completable, it should render with **lighter typography** so the user’s attention naturally lands on deliberate items (e.g. “Exercise”).

**Acceptance criteria**
- **AC-ROUTINE-1:** Routine edits persist and affect newly generated plans.
- **AC-ROUTINE-2:** Routine can be empty; app remains usable.
- **AC-ROUTINE-3:** A user can add → edit → delete a routine item in under 30 seconds without using Omni-Chat.
- **AC-ROUTINE-4:** User can toggle auto-complete on an item, and auto-completable items render with lighter typography.
    

## 4. Core MVP flows (minimum)

- **Flow A — Start from nothing:** open app → Home empty state → user types intent in Omni-Chat → system creates a Task (source=`chat`) → Home shows it as the next step.
- **Flow B — Disruption:** user types a state update (“I’m exhausted”) → system suggests a revised next step.
- **Flow C — Reschedule:** user slides time tweak on Home → confirm → optional reason capture.
- **Flow D — Completion:** user marks done → optional feeling check → next task appears.
- **Flow E — Routine edit:** user edits Routine template → future plans reference it.
- **Flow F — Profile transparency:** user opens Me → sees learned fields → edits/deletes one.

## 5. Minimal data model & events (MVP)

- **Task**
  - `id`, `title`, `scheduled_time` (optional), `status` (todo/done), `source` (routine/chat/system)
- **RoutineItem**
  - `id`, `title`, `time_window` (optional), `auto_complete` (boolean, default=false)
- **ProfileField**
  - `key`, `value`, `source` (user/learned), `updated_at`
- **Events to capture**
  - `task_completed`, `task_rescheduled`, `state_reported`, `profile_field_edited`

## 6. MVP “done” checklist

- User can complete **Flows A–F** end-to-end without errors.
- Home stays minimalist (one primary line) while still supporting reschedule + done.
- Routine and profile are optional (empty is valid).

## 7. API endpoints (MVP)

> Assumption (MVP): single-user, no auth.
> Practical note: to avoid mixing data across test devices, every request should include an `X-Install-Id` header (a locally generated install/device id) and the backend should scope reads/writes by that id.
> All endpoints are JSON over HTTPS. Prefix: `/api/v0`.

### 7.1 Tasks

- **List tasks**
  - `GET /api/v0/tasks?status=todo|done&limit=50`
- **Create task** (used by Flow A and by assistant actions)
  - `POST /api/v0/tasks`
  - Body: `{ "title": "string", "scheduled_time": "ISO-8601|null", "source": "chat|routine|system" }`
- **Get task**
  - `GET /api/v0/tasks/{task_id}`
- **Update task**
  - `PATCH /api/v0/tasks/{task_id}`
  - Body: `{ "title": "string?", "scheduled_time": "ISO-8601|null?", "status": "todo|done?" }`
- **Complete task** (preferred explicit event)
  - `POST /api/v0/tasks/{task_id}/complete`
  - Body: `{ "completed_at": "ISO-8601", "feeling": "string|null" }`
- **Reschedule task**
  - `POST /api/v0/tasks/{task_id}/reschedule`
  - Body: `{ "scheduled_time": "ISO-8601|null", "reason": "string|null" }`

### 7.2 Home (now/next)

- **Get now/next view model**
  - `GET /api/v0/home`
  - Response: `{ "current": Task|null, "next": Task|null }`

### 7.3 Routine

- **Get routine**
  - `GET /api/v0/routine`
  - Response: `{ "items": [RoutineItem] }`
- **Replace routine (simple MVP)**
  - `PUT /api/v0/routine`
  - Body: `{ "items": [{ "id": "string?", "title": "string", "time_window": "string|null", "auto_complete": "boolean?" }] }`

### 7.4 Profile fields

- **List profile fields**
  - `GET /api/v0/profile/fields`
- **Upsert a field**
  - `PUT /api/v0/profile/fields/{key}`
  - Body: `{ "value": "string", "source": "user|learned" }`
- **Delete a field**
  - `DELETE /api/v0/profile/fields/{key}`

### 7.5 Chat (Omni-Chat)

- **Send message**
  - `POST /api/v0/chat/messages`
  - Body:
    - `{ "conversation_id": "string|null", "tab": "home|routine|me", "text": "string" }`
  - Response (MVP shape):
    - `{ "conversation_id": "string", "assistant_text": "string", "actions": [Action] }`
  - `Action` examples:
    - `{ "type": "create_task", "title": "…", "scheduled_time": null }`
    - `{ "type": "suggest_reschedule", "task_id": "…", "scheduled_time": "…" }`
    - `{ "type": "upsert_profile_field", "key": "…", "value": "…" }`

- **Get recent history**
  - `GET /api/v0/chat/history?conversation_id=...&limit=50`

### 7.6 Events (optional but recommended)

> Use this if you want a single, append-only log for learning/debugging.

- `POST /api/v0/events`
  - Body: `{ "type": "task_completed|task_rescheduled|state_reported|profile_field_edited", "payload": {}, "occurred_at": "ISO-8601" }`

## 8. Stack choices (MVP implementation review)

### 8.1 Mobile app: React Native + Expo (start with Expo Go)

- **Verdict:** Good for MVP speed and iteration.
- **Recommendation:** Use **Expo Go** for early prototyping, but plan to switch to **EAS builds / Expo Dev Client** as soon as you need any native module not bundled in Expo Go (or when you start sharing test builds).
- **Key constraints to acknowledge upfront:**
  - **Streaming AI UX:** true token streaming can be awkward on RN depending on your networking approach; keep MVP tolerant of “single response” (non-streaming) and add streaming later.
  - **Storage/offline:** decide early whether “offline-first” is a goal. If not, keep client state light and treat backend as source of truth.

### 8.2 AI layer: Vercel AI SDK

- **Verdict:** Good choice **if the AI runs on a web/server runtime** (Node/Edge) and the mobile app talks to it.
- **Strong recommendation:** Do **not** call model providers directly from the app. Keep API keys and tool execution on the backend.
- **MVP shaping advice:**
  - Start with **non-streaming responses** (`assistant_text` returned as a whole) to reduce RN networking complexity.
  - Keep “actions” as the primary contract: the model outputs **typed actions** (create task, reschedule, upsert profile field), and the backend executes/validates them before returning results.

### 8.3 Backend: “basic backend” (minimum viable shape)

- **Verdict:** You want something boring and deployable quickly.
- **Recommended MVP shape (fits Vercel AI SDK well):**
  - **Backend runtime:** Next.js API routes (or a small Node server) hosting:
    - `/api/v0/chat/messages` (model call + action planning/execution)
    - CRUD endpoints in section 7
  - **Database:** hosted Postgres (e.g. Neon/Supabase) or SQLite during local dev; keep schema aligned with section 5.
  - **Identity without auth (pragmatic):** generate a **device/install id** and send it as `X-Install-Id` on every request so your “single-user, no auth” assumption doesn’t mix data across test devices.
